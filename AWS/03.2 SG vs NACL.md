# **Security Group vs NACL in AWS**

## **Overview**
Both **Security Groups (SGs)** and **Network Access Control Lists (NACLs)** are used to control traffic in AWS VPCs, but they operate at different layers and have distinct behaviors.

---

## **1. Security Groups (SGs)**
- **Operates at the instance level** (ENI - Elastic Network Interface).
- **Stateful**: Return traffic is automatically allowed, regardless of rules.
- **Supports "allow" rules only** (no deny rules).
- **Evaluates all rules** before allowing traffic.
- **No explicit ordering** of rules (all rules are evaluated).
- **Applies to an instance only if assigned** (must be explicitly associated).
- **Supports referencing other security groups** (for intra-VPC communication).
- **Can specify IP ranges, other security groups, or prefixes** in rules.

### **Example Rule:**
```json
{
  "Type": "SSH",
  "Protocol": "TCP",
  "Port": 22,
  "Source": "203.0.113.1/32"
}
```

---

## **2. Network ACLs (NACLs)**
- **Operates at the subnet level** (applies to all instances in the subnet).
- **Stateless**: Both inbound and outbound rules must be explicitly defined.
- **Supports both allow and deny rules**.
- **Rules are evaluated in order (rule number matters)**—first match applies.
- **Default NACL allows all traffic** (custom NACLs start with no rules).
- **Can block specific IPs or ports** (unlike SGs, which only allow).
- **No reference to other NACLs or security groups**—only IP ranges/CIDRs.

### **Example Rule:**
| Rule # | Type  | Protocol | Port Range | Source/Dest. | Allow/Deny |
|--------|-------|----------|------------|--------------|------------|
| 100    | SSH   | TCP      | 22         | 203.0.113.1/32 | ALLOW      |
| 200    | HTTP  | TCP      | 80         | 0.0.0.0/0    | ALLOW      |
| *      | ALL   | ALL      | ALL        | 0.0.0.0/0    | DENY       |

---

## **Key Differences**
| Feature            | Security Group (SG) | Network ACL (NACL) |
|--------------------|---------------------|--------------------|
| **Scope**          | Instance level      | Subnet level       |
| **Stateful/Stateless** | Stateful (auto return traffic) | Stateless (explicit rules needed) |
| **Rule Types**     | Allow only          | Allow + Deny        |
| **Rule Evaluation** | All rules evaluated | Ordered evaluation (first match) |
| **Default Behavior** | Deny all (unless allowed) | Default NACL allows all, custom NACLs deny all by default |
| **Association**    | Explicitly assigned to instances | Automatically applies to all instances in subnet |
| **References**     | Can reference other SGs | Only IP/CIDR-based rules |

---

## **When to Use Which?**
- **Use Security Groups** for:
  - Fine-grained instance-level control.
  - Allowing specific traffic to instances (e.g., SSH, HTTP).
  - Simplifying rules by referencing other SGs.

- **Use NACLs** for:
  - Subnet-wide traffic filtering (e.g., blocking malicious IPs).
  - Implementing deny rules (e.g., blocking a specific port).
  - Adding an extra layer of security (defense in depth).

---

## **Best Practices**
1. **Prefer Security Groups** for most use cases (simpler and stateful).
2. **Use NACLs sparingly**—only when subnet-wide rules are needed.
3. **Order NACL rules carefully** (lower-numbered rules take precedence).
4. **Test NACL changes**—misconfigurations can block all traffic.
5. **Combine both** for defense in depth (e.g., SG allows SSH, NACL blocks a malicious IP).

---

### **Summary**
- **Security Groups** = Instance-level, stateful, allow-only.
- **NACLs** = Subnet-level, stateless, allow + deny, rule-order matters.  
Both work together to secure AWS resources effectively.
---
---
# **Step-by-Step Guide to Configuring Security Groups & NACLs in AWS**

This guide covers setting up **Security Groups (SGs)** and **Network Access Control Lists (NACLs)** to control traffic in your AWS VPC.

---

## **Part 1: Configuring Security Groups (Stateful Firewall)**
Security Groups act as virtual firewalls for EC2 instances and other AWS services.

### **Step 1: Navigate to Security Groups**
1. Go to the **AWS VPC Dashboard**.
2. In the left sidebar, click **"Security Groups"**.

### **Step 2: Create a New Security Group**
1. Click **"Create security group"**.
2. Configure basic settings:
   - **Security group name**: (e.g., `WebServer-SG`).
   - **Description**: (e.g., "Allow HTTP/HTTPS and SSH").
   - **VPC**: Select your VPC (e.g., `My-VPC`).
3. Click **"Create security group"**.

### **Step 3: Add Inbound Rules (Ingress Rules)**
1. Select the newly created **Security Group**.
2. Click **"Edit inbound rules"**.
3. Add rules (examples below):

| **Type**       | **Protocol** | **Port Range** | **Source**                | **Description**          |
|----------------|-------------|----------------|---------------------------|--------------------------|
| **SSH**        | TCP         | 22             | `Your-IP/32` (or a trusted IP) | Secure Shell access      |
| **HTTP**       | TCP         | 80             | `0.0.0.0/0` (or a specific IP) | Web traffic             |
| **HTTPS**      | TCP         | 443            | `0.0.0.0/0`               | Secure web traffic      |
| **Custom TCP** | TCP         | 8080           | `10.0.0.0/16` (VPC CIDR)  | Internal app traffic    |

4. Click **"Save rules"**.

### **Step 4: (Optional) Configure Outbound Rules (Egress Rules)**
1. Click **"Edit outbound rules"**.
2. By default, **all outbound traffic is allowed**. Restrict if needed:
   - Example: Allow only HTTPS outbound to `0.0.0.0/0` on port `443`.
3. Click **"Save rules"**.

### **Step 5: Assign Security Group to an EC2 Instance**
1. Go to **EC2 Dashboard > Instances**.
2. Select an instance > Click **Actions > Security > Change security groups**.
3. Select your **Security Group** (e.g., `WebServer-SG`).
4. Click **"Save"**.

✅ **Security Group is now active!**

---

## **Part 2: Configuring Network ACLs (Stateless Firewall)**
NACLs act as an additional layer of security at the **subnet level**.

### **Step 1: Navigate to Network ACLs**
1. In the **VPC Dashboard**, click **"Network ACLs"** in the left sidebar.

### **Step 2: Create a New Network ACL**
1. Click **"Create network ACL"**.
2. Configure:
   - **Name**: (e.g., `Public-Subnet-NACL`).
   - **VPC**: Select your VPC (e.g., `My-VPC`).
3. Click **"Create"**.

### **Step 3: Associate NACL with Subnets**
1. Select the **NACL** > Click **"Subnet associations"**.
2. Click **"Edit subnet associations"**.
3. Select **subnets** (e.g., `Public-Subnet-1`).
4. Click **"Save"**.

### **Step 4: Configure Inbound Rules (Ingress Rules)**
1. Select the **NACL** > Click **"Inbound rules"** > **"Edit inbound rules"**.
2. Add rules (order matters! Lower rule numbers take priority):

| **Rule #** | **Type** | **Protocol** | **Port Range** | **Source IP** | **Allow/Deny** |
|------------|---------|-------------|----------------|--------------|----------------|
| 100        | HTTP    | TCP (6)     | 80             | 0.0.0.0/0    | ALLOW          |
| 110        | HTTPS   | TCP (6)     | 443            | 0.0.0.0/0    | ALLOW          |
| 120        | SSH     | TCP (6)     | 22             | Your-IP/32   | ALLOW          |
| 130        | Ephemeral Ports | TCP (6) | 1024-65535 | 0.0.0.0/0 | ALLOW (for responses) |
| * (Default) | ALL     | ALL         | ALL            | 0.0.0.0/0    | DENY           |

3. Click **"Save changes"**.

### **Step 5: Configure Outbound Rules (Egress Rules)**
1. Select the **NACL** > Click **"Outbound rules"** > **"Edit outbound rules"**.
2. Add rules:

| **Rule #** | **Type** | **Protocol** | **Port Range** | **Destination IP** | **Allow/Deny** |
|------------|---------|-------------|----------------|-------------------|----------------|
| 100        | HTTP    | TCP (6)     | 80             | 0.0.0.0/0         | ALLOW          |
| 110        | HTTPS   | TCP (6)     | 443            | 0.0.0.0/0         | ALLOW          |
| 120        | Ephemeral Ports | TCP (6) | 1024-65535 | 0.0.0.0/0 | ALLOW (for responses) |
| * (Default) | ALL     | ALL         | ALL            | 0.0.0.0/0         | DENY           |

3. Click **"Save changes"**.

✅ **NACL is now active!**

---

## **Security Groups vs. NACLs: Key Differences**
| **Feature**          | **Security Groups (SGs)** | **Network ACLs (NACLs)** |
|----------------------|--------------------------|--------------------------|
| **Stateful/Stateless** | Stateful (return traffic allowed automatically) | Stateless (must explicitly allow return traffic) |
| **Scope** | Instance-level | Subnet-level |
| **Rule Evaluation** | All rules evaluated before allowing traffic | Rules evaluated in order (lowest rule # first) |
| **Default Action** | Deny all inbound, Allow all outbound | Deny all inbound & outbound (must explicitly allow) |

---

## **Best Practices**
✔ **Use Security Groups as the primary defense** (simpler & stateful).  
✔ **Use NACLs for additional subnet-level filtering** (e.g., block specific IPs).  
✔ **Test changes in a staging environment first**.  
✔ **Log traffic using VPC Flow Logs** for auditing.  

---

## **Troubleshooting**
| **Issue** | **Solution** |
|-----------|-------------|
| **EC2 instance not accessible** | Check if SG allows inbound traffic on the required port. |
| **NACL blocking expected traffic** | Verify rule numbers (lower numbers take priority). |
| **Ephemeral port issues** | Ensure NACL allows return traffic (ports `1024-65535`). |

---

### **Next Steps**
- Set up **VPC Flow Logs** for traffic monitoring.  
- Configure **AWS WAF** for web application protection.  
